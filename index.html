<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B2B Sales Strategist AI</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React e React DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel per trasformare JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 18px;
            color: #4f46e5;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-right: 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div class="spinner"></div>
            Caricamento B2B Sales Strategist AI...
        </div>
    </div>
    
    <script type="text/babel">
        const { useState, useCallback, useEffect } = React;

        // API Configuration
        const API_KEY = "AIzaSyCwtjsNaWLh28_bXrHJOHaMgzFDVjOHXiQ";

        // Mock icons usando caratteri Unicode
        const Icons = {
            UserCheck: () => <span style={{fontSize: '24px'}}>üë§</span>,
            MessageSquareQuote: () => <span style={{fontSize: '24px'}}>üí¨</span>,
            FileQuestion: () => <span style={{fontSize: '24px'}}>üìã</span>,
            Activity: () => <span style={{fontSize: '24px'}}>üìä</span>,
            Link2: () => <span style={{fontSize: '24px'}}>üîó</span>,
            DollarSign: () => <span style={{fontSize: '24px'}}>üí∞</span>,
            Gavel: () => <span style={{fontSize: '24px'}}>‚öñÔ∏è</span>,
            ChevronRight: () => <span style={{fontSize: '16px'}}>‚û°Ô∏è</span>,
            ChevronLeft: () => <span style={{fontSize: '16px'}}>‚¨ÖÔ∏è</span>,
            Info: () => <span style={{fontSize: '24px'}}>‚ÑπÔ∏è</span>,
            Target: () => <span style={{fontSize: '20px'}}>üéØ</span>,
            Copy: () => <span style={{fontSize: '16px'}}>üìã</span>,
            Check: () => <span style={{fontSize: '16px'}}>‚úÖ</span>,
            Loader2: () => <div className="spinner" style={{width: '20px', height: '20px', border: '3px solid #f3f4f6', borderTop: '3px solid #4f46e5'}}></div>
        };

        // Gemini API Hook
        function useGeminiGenerator() {
            const [isGenerating, setIsGenerating] = useState(false);
            const [error, setError] = useState(null);

            const generateContent = useCallback(async (prompt, isJson = false) => {
                setIsGenerating(true);
                setError(null);
                
                try {
                    const modelName = "gemini-2.5-pro";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${API_KEY}`;

                    const requestBody = {
                        contents: [{ role: "user", parts: [{ text: prompt }] }],
                        generationConfig: isJson ? { responseMimeType: "application/json" } : {},
                    };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestBody),
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API Error (${response.status}): ${response.statusText}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                        let rawText = result.candidates[0].content.parts[0].text;
                        rawText = rawText.replace(/^\s*```(json|html|markdown)?\n?/, '').replace(/\n?```\s*$/, '');
                        setIsGenerating(false);
                        return rawText;
                    } else {
                        throw new Error("Risposta AI non valida");
                    }
                } catch (err) {
                    console.error("Errore durante la generazione:", err);
                    setError(err.message);
                    setIsGenerating(false);
                    throw err;
                }
            }, []);

            return { isGenerating, error, generateContent };
        }

        // Persistent State Hook
        function usePersistentState(key, defaultValue) {
            const [state, setState] = useState(() => {
                try {
                    const persistentState = localStorage.getItem(key);
                    return persistentState ? JSON.parse(persistentState) : defaultValue;
                } catch (error) {
                    return defaultValue;
                }
            });

            useEffect(() => {
                try {
                    localStorage.setItem(key, JSON.stringify(state));
                } catch (error) {
                    console.warn('Errore nel salvare lo stato:', error);
                }
            }, [key, state]);

            return [state, setState];
        }

        // Copy Button Component
        const CopyButton = ({ text, label = "Copia" }) => {
            const [copied, setCopied] = useState(false);

            const handleCopy = useCallback(() => {
                if (!text) return;

                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.top = "-9999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();

                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        setCopied(true);
                        setTimeout(() => setCopied(false), 2000);
                    }
                } catch (err) {
                    console.error('Errore copia:', err);
                }

                document.body.removeChild(textArea);
            }, [text]);

            return (
                <button 
                    onClick={handleCopy} 
                    className="inline-flex items-center px-3 py-1.5 bg-gray-200 text-gray-700 text-xs font-medium rounded-lg hover:bg-gray-300 transition-colors"
                >
                    {copied ? <Icons.Check /> : <Icons.Copy />}
                    <span className="ml-1">{copied ? 'Copiato!' : label}</span>
                </button>
            );
        };

        // Loading Placeholder
        const GeneratingPlaceholder = ({ text = "L'AI sta lavorando per te..." }) => (
            <div className="w-full min-h-[15rem] flex flex-col items-center justify-center bg-gray-100 rounded-lg p-8 text-center border">
                <Icons.Loader2 />
                <p className="text-lg font-medium text-gray-700 mt-4">{text}</p>
                <p className="text-sm text-gray-500 mt-1">Questa operazione potrebbe richiedere qualche istante.</p>
            </div>
        );

        // Homepage Component
        const IntroSection = ({ 
            onStartWizard, 
            onStartPQP, 
            onStartValueChain, 
            onStartBusinessCase, 
            onStartPostMeeting, 
            onStartRfqAnalyzer, 
            onStartNegotiation 
        }) => {
            const modules = [
                { 
                    icon: Icons.UserCheck, 
                    title: "Consulente Strategico", 
                    text: "Ricevi consigli strategici personalizzati per le tue situazioni commerciali.", 
                    action: onStartWizard, 
                    buttonText: "Inizia",
                    color: "bg-indigo-600 hover:bg-indigo-700"
                },
                { 
                    icon: Icons.Activity, 
                    title: "Qualifica (PQP)", 
                    text: "Analizza la solidit√† delle tue opportunit√† commerciali con il Profilo di Qualificazione Progetto.", 
                    action: onStartPQP, 
                    buttonText: "Inizia",
                    color: "bg-teal-600 hover:bg-teal-700"
                },
                { 
                    icon: Icons.DollarSign, 
                    title: "Business Case", 
                    text: "Crea documenti persuasivi e quantificati per convincere il C-level.", 
                    action: onStartBusinessCase, 
                    buttonText: "Inizia",
                    color: "bg-emerald-600 hover:bg-emerald-700"
                },
                { 
                    icon: Icons.MessageSquareQuote, 
                    title: "Post-Meeting", 
                    text: "Genera sintesi professionali dai tuoi appunti di meeting.", 
                    action: onStartPostMeeting, 
                    buttonText: "Presto",
                    color: "bg-gray-400"
                },
                { 
                    icon: Icons.FileQuestion, 
                    title: "Analizza Gara", 
                    text: "Estrai insight strategici dalla documentazione di gara.", 
                    action: onStartRfqAnalyzer, 
                    buttonText: "Presto",
                    color: "bg-gray-400"
                },
                { 
                    icon: Icons.Gavel, 
                    title: "Negoziazione", 
                    text: "Prepara la tua strategia di negoziazione con ZOPA e MAAN.", 
                    action: onStartNegotiation, 
                    buttonText: "Presto",
                    color: "bg-gray-400"
                }
            ];

            return (
                <div className="max-w-6xl mx-auto px-4 py-12">
                    <div className="bg-white rounded-xl shadow-lg p-8">
                        <div className="text-center mb-12">
                            <Icons.Info />
                            <h2 className="text-4xl font-bold text-gray-900 mb-4 mt-4">
                                Benvenuto in B2B Sales Strategist AI
                            </h2>
                            <p className="text-xl text-gray-700 max-w-3xl mx-auto">
                                Il tuo partner strategico basato sulla metodologia Var Group Way of Selling
                            </p>
                        </div>
                        
                        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {modules.map((module, i) => (
                                <div 
                                    key={i}
                                    className="border border-gray-200 rounded-lg p-6 card-hover bg-white"
                                >
                                    <div className="flex items-center mb-4">
                                        <module.icon />
                                        <h3 className="text-xl font-semibold text-gray-800 ml-3">
                                            {module.title}
                                        </h3>
                                    </div>
                                    <p className="text-gray-600 mb-6 flex-grow">
                                        {module.text}
                                    </p>
                                    <button 
                                        onClick={module.action}
                                        disabled={module.buttonText === "Presto"}
                                        className={`w-full inline-flex items-center justify-center px-6 py-2.5 text-white font-medium rounded-lg transition-colors ${module.color} disabled:opacity-50 disabled:cursor-not-allowed`}
                                    >
                                        {module.buttonText}
                                        {module.buttonText !== "Presto" && <Icons.ChevronRight />}
                                    </button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // Wizard Module
        const SimpleWizardModule = ({ onBack }) => {
            const { isGenerating, generateContent, error } = useGeminiGenerator();
            const [input, setInput] = useState('');
            const [output, setOutput] = useState('');

            const handleGenerate = async () => {
                if (!input.trim()) {
                    alert('Inserisci una descrizione della situazione');
                    return;
                }
                
                const prompt = `Agisci come un consulente strategico esperto di Var Group, specializzato in vendite B2B complesse. 

SITUAZIONE DA ANALIZZARE:
${input}

Fornisci un'analisi strategica strutturata con:

1. ANALISI DELLA SITUAZIONE
   - Riassumi i punti chiave
   - Identifica opportunit√† e rischi

2. RACCOMANDAZIONI STRATEGICHE
   - 3-4 azioni concrete da intraprendere
   - Prioritizza per impatto e fattibilit√†

3. PROSSIMI PASSI
   - Timeline suggerita
   - Risorse necessarie
   - Metriche di successo

Sii specifico, pratico e orientato ai risultati. Usa la metodologia Var Group Way of Selling.`;

                try {
                    const result = await generateContent(prompt);
                    setOutput(result);
                } catch (error) {
                    alert('Errore nella generazione: ' + error.message);
                }
            };

            return (
                <div className="max-w-4xl mx-auto px-4 py-8">
                    <button 
                        onClick={onBack} 
                        className="inline-flex items-center mb-6 px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition-colors"
                    >
                        <Icons.ChevronLeft />
                        <span className="ml-2">Torna alla Homepage</span>
                    </button>
                    
                    <div className="bg-white rounded-xl shadow-lg p-8">
                        <div className="flex items-center mb-6">
                            <Icons.Target />
                            <h2 className="text-2xl font-bold text-gray-800 ml-3">
                                Consulente Strategico AI
                            </h2>
                        </div>
                        
                        <div className="space-y-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Descrivi la tua situazione commerciale o strategica
                                </label>
                                <textarea
                                    value={input}
                                    onChange={(e) => setInput(e.target.value)}
                                    rows="6"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="Es: Sto preparando un incontro con un cliente nel settore manifatturiero che ha problemi di supply chain. Il budget √® di 200k‚Ç¨ ma ci sono 3 competitor..."
                                />
                            </div>
                            
                            <button 
                                onClick={handleGenerate}
                                disabled={!input.trim() || isGenerating}
                                className="w-full inline-flex items-center justify-center px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 disabled:opacity-50 transition-colors"
                            >
                                {isGenerating ? (
                                    <>
                                        <Icons.Loader2 />
                                        <span className="ml-2">Analisi in corso...</span>
                                    </>
                                ) : (
                                    <>
                                        <Icons.Target />
                                        <span className="ml-2">Genera Strategia</span>
                                    </>
                                )}
                            </button>
                            
                            {error && (
                                <div className="p-4 bg-red-50 border border-red-200 rounded-lg">
                                    <p className="text-red-700">Errore: {error}</p>
                                </div>
                            )}
                            
                            {output && (
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-semibold text-gray-800">
                                            Analisi Strategica
                                        </h3>
                                        <CopyButton text={output} />
                                    </div>
                                    <div className="bg-gray-50 p-6 rounded-lg border">
                                        <div className="whitespace-pre-wrap text-sm leading-relaxed">
                                            {output}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // PQP Module
        const SimplePQPModule = ({ onBack }) => {
            const { isGenerating, generateContent, error } = useGeminiGenerator();
            const [formData, setFormData] = useState({
                companyName: '',
                serviceName: '',
                meetingNotes: ''
            });
            const [pqpResult, setPqpResult] = useState(null);

            const handleGenerate = async () => {
                if (!formData.companyName || !formData.meetingNotes) {
                    alert('Compila almeno il nome azienda e le note del meeting');
                    return;
                }

                const prompt = `Agisci come un Sales Director esperto di Var Group. Analizza questa opportunit√† commerciale utilizzando il framework PQP (Profilo di Qualificazione Progetto).

DATI DELL'OPPORTUNIT√Ä:
- Azienda Cliente: ${formData.companyName}
- Servizio/Soluzione: ${formData.serviceName || 'Non specificato'}
- Note dal Meeting: ${formData.meetingNotes}

Fornisci una valutazione PQP strutturata con:

1. PUNTEGGIO COMPLESSIVO (da 1 a 5)
   - Giustifica il punteggio

2. RACCOMANDAZIONE FINALE
   - GO / GO CON CAUTELA / NO-GO
   - Motivazione della raccomandazione

3. ANALISI DEI FATTORI CHIAVE
   - Urgenza/Pain del cliente
   - Budget e processo decisionale
   - Accesso ai decisori (GDEUA)
   - Posizione competitiva
   - Timeline realistiche

4. PUNTI DI FORZA
   - Cosa gioca a nostro favore

5. PUNTI DI DEBOLEZZA
   - Rischi da mitigare

6. PROSSIMI PASSI CONCRETI
   - Azioni specifiche con responsabili e scadenze

Sii oggettivo, specifico e orientato all'azione.`;

                try {
                    const result = await generateContent(prompt);
                    setPqpResult(result);
                } catch (error) {
                    alert('Errore nella generazione: ' + error.message);
                }
            };

            return (
                <div className="max-w-4xl mx-auto px-4 py-8">
                    <button 
                        onClick={onBack} 
                        className="inline-flex items-center mb-6 px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition-colors"
                    >
                        <Icons.ChevronLeft />
                        <span className="ml-2">Torna alla Homepage</span>
                    </button>
                    
                    <div className="bg-white rounded-xl shadow-lg p-8">
                        <div className="flex items-center mb-6">
                            <Icons.Activity />
                            <h2 className="text-2xl font-bold text-gray-800 ml-3">
                                Analisi PQP - Qualificazione Progetto
                            </h2>
                        </div>
                        
                        <div className="space-y-6">
                            <div className="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Nome Azienda Cliente *
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.companyName}
                                        onChange={(e) => setFormData(prev => ({...prev, companyName: e.target.value}))}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                                        placeholder="Es. Acme Corporation"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Servizio/Soluzione
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.serviceName}
                                        onChange={(e) => setFormData(prev => ({...prev, serviceName: e.target.value}))}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                                        placeholder="Es. Digital Transformation, SAP Implementation..."
                                    />
                                </div>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Note dal Meeting *
                                </label>
                                <textarea
                                    value={formData.meetingNotes}
                                    onChange={(e) => setFormData(prev => ({...prev, meetingNotes: e.target.value}))}
                                    rows="8"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                                    placeholder="Inserisci dettagli del meeting: partecipanti e ruoli, problemi discussi, budget accennato, timeline, competitor menzionati, feedback ricevuto, prossimi step concordati..."
                                />
                            </div>
                            
                            <button 
                                onClick={handleGenerate}
                                disabled={isGenerating || !formData.companyName || !formData.meetingNotes}
                                className="w-full inline-flex items-center justify-center px-6 py-3 bg-teal-600 text-white font-medium rounded-lg hover:bg-teal-700 disabled:opacity-50 transition-colors"
                            >
                                {isGenerating ? (
                                    <>
                                        <Icons.Loader2 />
                                        <span className="ml-2">Analisi in corso...</span>
                                    </>
                                ) : (
                                    <>
                                        <Icons.Activity />
                                        <span className="ml-2">Analizza Opportunit√†</span>
                                    </>
                                )}
                            </button>
                            
                            {error && (
                                <div className="p-4 bg-red-50 border border-red-200 rounded-lg">
                                    <p className="text-red-700">Errore: {error}</p>
                                </div>
                            )}
                            
                            {pqpResult && (
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-semibold text-gray-800">
                                            Risultati PQP per {formData.companyName}
                                        </h3>
                                        <CopyButton text={pqpResult} />
                                    </div>
                                    <div className="bg-gray-50 p-6 rounded-lg border">
                                        <div className="whitespace-pre-wrap text-sm leading-relaxed">
                                            {pqpResult}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Business Case Module
        const SimpleBusinessCaseModule = ({ onBack }) => {
            const { isGenerating, generateContent, error } = useGeminiGenerator();
            const [formData, setFormData] = useState({
                companyName: '',
                problemDescription: '',
                solutionDescription: '',
                audience: 'C-Level'
            });
            const [businessCase, setBusinessCase] = useState('');

            const handleGenerate = async () => {
                if (!formData.companyName || !formData.problemDescription) {
                    alert('Compila almeno il nome azienda e la descrizione del problema');
                    return;
                }

                const prompt = `Agisci come un consulente strategico senior di Var Group. Crea un Business Case persuasivo e professionale per ${formData.audience}.

CONTESTO DEL BUSINESS CASE:
- Azienda Cliente: ${formData.companyName}
- Problema Identificato: ${formData.problemDescription}
- Soluzione Proposta: ${formData.solutionDescription || 'Da definire in base al problema'}
- Audience Target: ${formData.audience}

Crea un Business Case strutturato e professionale con:

1. SINTESI ESECUTIVA
   - 2-3 frasi che catturano il valore del progetto
   - ROI potenziale in evidenza

2. SITUAZIONE ATTUALE
   - Il problema e il suo impatto sul business
   - Costi dell'inazione (quantificati se possibile)

3. SOLUZIONE PROPOSTA
   - Come Var Group risolve il problema
   - Approccio metodologico e competenze distintive

4. BENEFICI ATTESI
   - Benefici quantitativi (risparmi, ricavi, efficienza)
   - Benefici qualitativi (competitivit√†, riduzione rischi)
   - Timeline di realizzazione

5. INVESTIMENTO RICHIESTO
   - Struttura generale dell'investimento
   - Modalit√† di pagamento suggerite

6. ANALISI ROI
   - Calcolo del ritorno sull'investimento
   - Tempo di recupero dell'investimento

7. RACCOMANDAZIONE
   - Call to action chiara e next steps

Usa un linguaggio diretto, professionale e orientato ai risultati. Includi numeri realistici e benefici tangibili. Adatta il tono per ${formData.audience}.`;

                try {
                    const result = await generateContent(prompt);
                    setBusinessCase(result);
                } catch (error) {
                    alert('Errore nella generazione: ' + error.message);
                }
            };

            return (
                <div className="max-w-4xl mx-auto px-4 py-8">
                    <button 
                        onClick={onBack} 
                        className="inline-flex items-center mb-6 px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition-colors"
                    >
                        <Icons.ChevronLeft />
                        <span className="ml-2">Torna alla Homepage</span>
                    </button>
                    
                    <div className="bg-white rounded-xl shadow-lg p-8">
                        <div className="flex items-center mb-6">
                            <Icons.DollarSign />
                            <h2 className="text-2xl font-bold text-gray-800 ml-3">
                                Generatore Business Case
                            </h2>
                        </div>
                        
                        <div className="space-y-6">
                            <div className="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Nome Azienda *
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.companyName}
                                        onChange={(e) => setFormData(prev => ({...prev, companyName: e.target.value}))}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
                                        placeholder="Es. Acme Corporation"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Audience Target
                                    </label>
                                    <select
                                        value={formData.audience}
                                        onChange={(e) => setFormData(prev => ({...prev, audience: e.target.value}))}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
                                    >
                                        <option>C-Level</option>
                                        <option>IT Manager</option>
                                        <option>CFO</option>
                                        <option>Operations Manager</option>
                                        <option>Procurement</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Descrizione del Problema *
                                </label>
                                <textarea
                                    value={formData.problemDescription}
                                    onChange={(e) => setFormData(prev => ({...prev, problemDescription: e.target.value}))}
                                    rows="4"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
                                    placeholder="Es: L'azienda ha sistemi IT obsoleti che causano inefficienze nella supply chain, perdite di tempo del 30% nei processi di ordine e difficolt√† nel tracking delle scorte..."
                                />
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Soluzione Proposta
                                </label>
                                <textarea
                                    value={formData.solutionDescription}
                                    onChange={(e) => setFormData(prev => ({...prev, solutionDescription: e.target.value}))}
                                    rows="4"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
                                    placeholder="Es: Implementazione di SAP S/4HANA con moduli Supply Chain, integrazione IoT per tracking real-time, formazione del personale..."
                                />
                            </div>
                            
                            <button 
                                onClick={handleGenerate}
                                disabled={isGenerating || !formData.companyName || !formData.problemDescription}
                                className="w-full inline-flex items-center justify-center px-6 py-3 bg-emerald-600 text-white font-medium rounded-lg hover:bg-emerald-700 disabled:opacity-50 transition-colors"
                            >
                                {isGenerating ? (
                                    <>
                                        <Icons.Loader2 />
                                        <span className="ml-2">Generazione in corso...</span>
                                    </>
                                ) : (
                                    <>
                                        <Icons.DollarSign />
                                        <span className="ml-2">Genera Business Case</span>
                                    </>
                                )}
                            </button>
                            
                            {error && (
                                <div className="p-4 bg-red-50 border border-red-200 rounded-lg">
                                    <p className="text-red-700">Errore: {error}</p>
                                </div>
                            )}
                            
                            {businessCase && (
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-lg font-semibold text-gray-800">
                                            Business Case per {formData.companyName}
                                        </h3>
                                        <CopyButton text={businessCase} />
                                    </div>
                                    <div className="bg-gray-50 p-6 rounded-lg border">
                                        <div className="whitespace-pre-wrap text-sm leading-relaxed">
                                            {businessCase}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [currentView, setCurrentView] = usePersistentState('b2b-sales-ai-currentView', 'intro');

            const goToHome = () => setCurrentView('intro');

            const renderCurrentView = () => {
                switch (currentView) {
                    case 'intro': 
                        return (
                            <IntroSection 
                                onStartWizard={() => setCurrentView('wizard')} 
                                onStartPostMeeting={() => alert('Modulo Post-Meeting - Disponibile nella versione completa')}
                                onStartRfqAnalyzer={() => alert('Modulo RFQ Analyzer - Disponibile nella versione completa')}
                                onStartPQP={() => setCurrentView('pqp')} 
                                onStartValueChain={() => alert('Modulo Value Chain - Disponibile nella versione completa')}
                                onStartBusinessCase={() => setCurrentView('businessCase')}
                                onStartNegotiation={() => alert('Modulo Negoziazione - Disponibile nella versione completa')}
                            />
                        );
                    
                    case 'wizard': 
                        return <SimpleWizardModule onBack={goToHome} />;
                    
                    case 'pqp': 
                        return <SimplePQPModule onBack={goToHome} />;
                    
                    case 'businessCase': 
                        return <SimpleBusinessCaseModule onBack={goToHome} />;

                    default: 
                        return (
                            <IntroSection 
                                onStartWizard={() => setCurrentView('wizard')} 
                                onStartPQP={() => setCurrentView('pqp')} 
                                onStartBusinessCase={() => setCurrentView('businessCase')}
                                onStartPostMeeting={() => alert('Modulo in sviluppo')}
                                onStartRfqAnalyzer={() => alert('Modulo in sviluppo')}
                                onStartValueChain={() => alert('Modulo in sviluppo')}
                                onStartNegotiation={() => alert('Modulo in sviluppo')}
                            />
                        );
                }
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <div className="bg-white shadow-sm border-b">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                            <div>
                                <h1 className="text-2xl sm:text-3xl font-bold text-gray-900">
                                    B2B Sales Strategist AI
                                </h1>
                                <p className="text-gray-600 mt-1 text-sm sm:text-base">
                                    Il tuo partner strategico basato sulla metodologia Var Group Way of Selling
                                </p>
                            </div>
                            {currentView !== 'intro' && (
                                <button 
                                    onClick={goToHome} 
                                    className="text-sm font-medium text-indigo-600 hover:text-indigo-800 transition-colors"
                                >
                                    Torna alla Homepage
                                </button>
                            )}
                        </div>
                    </div>
                    
                    {/* Main Content */}
                    <main>
                        {renderCurrentView()}
                    </main>
                    
                    {/* Footer */}
                    <footer className="mt-16 pb-8 text-center text-sm text-gray-500">
                        <p>
                            Questo strumento √® una creazione originale di{' '}
                            <a
                                href="https://www.linkedin.com/in/alessandrodigrazia/"
                                target="_blank"
                                rel="noopener noreferrer"
                                className="font-semibold text-indigo-600 hover:text-indigo-700"
                            >
                                Alessandro Di Grazia
                            </a>.
                        </p>
                        <p className="mt-3 text-sm text-gray-400 max-w-3xl mx-auto px-4">
                            La logica sottostante fonde il framework metodologico Var Group Way of Selling sviluppato con{' '}
                            <a
                                href="https://www.blackship.it/"
                                target="_blank"
                                rel="noopener noreferrer"
                                className="font-medium text-indigo-500 hover:text-indigo-700"
                            >
                                BlackShip
                            </a>{' '}
                            con innovative tecniche di vendita strategica supportata dall'AI.
                        </p>
                    </footer>
                </div>
            );
        };

        // Error Boundary per debug
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }

            componentDidCatch(error, errorInfo) {
                console.error('React Error:', error, errorInfo);
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="min-h-screen flex items-center justify-center bg-gray-50">
                            <div className="text-center p-8">
                                <h1 className="text-2xl font-bold text-red-600 mb-4">
                                    Errore nell'applicazione
                                </h1>
                                <p className="text-gray-600 mb-4">
                                    Si √® verificato un errore. Ricarica la pagina per riprovare.
                                </p>
                                <button 
                                    onClick={() => window.location.reload()}
                                    className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                                >
                                    Ricarica Pagina
                                </button>
                                <details className="mt-4 text-left">
                                    <summary className="cursor-pointer text-sm text-gray-500">
                                        Dettagli errore (per debug)
                                    </summary>
                                    <pre className="mt-2 text-xs bg-gray-100 p-2 rounded overflow-auto">
                                        {this.state.error?.toString()}
                                    </pre>
                                </details>
                            </div>
                        </div>
                    );
                }

                return this.props.children;
            }
        }

        // Render dell'app con gestione errori
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            React.createElement(ErrorBoundary, null,
                React.createElement(App)
            )
        );

        // Debug per verificare che tutto sia caricato
        console.log('‚úÖ B2B Sales Strategist AI - Applicazione caricata con successo!');
        console.log('üîß React:', typeof React);
        console.log('üîß ReactDOM:', typeof ReactDOM);
        
    </script>
</body>
</html>
